# _nya は NYAOS の初期設定ファイルです.
#   (1) NYAOS.EXE のあるディレクトリ
#   (2) %HOME% の下(未定義であれば %USERPROFILE%)
#   (3) カレントディレクトリ
# にある _nya を「順に全て」呼び出します.
# ※ ただし、(1)==(3) の場合等は、(3)を呼び出しません.
#
# 通常
#    - NYAOS.EXE に添付の _nya (当ファイル) は (1) へ
#    - そのユーザで定義する設定は (2) へ
# 配置してください.

print %0 reading ...

suffix ny  %nyatype% -f
suffix pl  perl
suffix py  python
suffix rb  ruby
suffix jar java -jar
suffix lua lua
suffix awk awk -f
suffix vbs cscript
suffix js  cscript

option +standalone
option uncompletechar ,;=
option tilde   on
option history on
option backquote  4000
option +keep_bottom_line
if $standalone = (set) then
    foreach i (dir mkdir rmdir copy move rename ren type md rd start)
	alias $i $COMSPEC /c $i
    end
    suffix cmd %COMSPEC% /c
    suffix bat %COMSPEC% /c
    alias dir\w %COMSPEC% /c dir /w
else
    alias dir\w dir /w
endif

bindkey CTRL_P vzlike-previous-history
bindkey CTRL_N vzlike-next-history

if %nyatype% == NYACUS then
    # NYACUS でのみ実行する部分をここに記述.
    # option start "start """""
endif
option prompt $e[31;40;1m[$w]$_$$ $e[37;1m

# 関数 which の定義.
which{
    foreach dir . ${PATH.split}
	foreach ext .com .exe .bat .cmd
	    if exist $dir\$1$ext then
		print found $dir\$1$ext
	    endif
	end
    end
}

### Vzライクなキーバインドにする関数
### 利用時には「vzbind」とだけの行を入れてください。
vzbind{
    bindkey CTRL_R xscript:start            xscript:pageup
    bindkey CTRL_S backward                 xscript:backward
    bindkey CTRL_D forward                  xscript:forward
    bindkey CTRL_E vzlike-previous-history  xscript:previous
    bindkey CTRL_X vzlike-next-history      xscript:next
    bindkey CTRL_F forward-word
    bindkey CTRL_A backward-word
}
# vzbind

lua_e "
    --- keyhook ---
    function nyaos.keyhook(t)
        if t.key == nyaos.key.ESCAPE and t.text == '' then
            return os.getenv('EDITOR') or 'notepad',true
        end
        return nil
    end
    --「%(Lua式)」を処理する Lua コード --
    function nyaos.filter(cmdline)
        return cmdline:gsub('%%(%b())',function(m)
            return loadstring('return '..m)()
        end)
    end
    -- say コマンド --
    function nyaos.command.say(message)
        print(message)
    end

    print('done')
"
